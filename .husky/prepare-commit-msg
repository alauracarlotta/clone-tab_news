# TODO
# Quando o commit √© normal, $2 (COMMIT_SOURCE) vem vazio
# Quando o commit √© amend, $2 = amend
# Quando √© commit autom√°tico, $3 tem hash

#!/bin/sh

MSG_FILE="$1"
COMMIT_SOURCE="$2"

echo "üî• PREPARE-COMMIT-MSG rodando..."
echo "MSG_FILE: $MSG_FILE"
echo "COMMIT_SOURCE: $COMMIT_SOURCE"
echo "-------------------------------------------"

# Fun√ß√£o auxiliar ‚Äì verifica se conte√∫do real est√° vazio
mensagem_vazia() {
  contents=$(grep -vE '^(#|$)' "$MSG_FILE")
  [ -z "$contents" ]
}

# 1Ô∏è‚É£ Se a mensagem estiver vazia ‚Üí roda Commitizen
if mensagem_vazia; then
  echo "‚ö° Mensagem vazia ‚Äî rodando Commitizen"

  exec < /dev/tty
  npx cz --hook || true

  echo "üîí Mensagem gerada ‚Äî impedindo abertura de editor"
  exit 0  # ‚Üê ESSA LINHA √© o segredo
fi

echo "‚úî Mensagem j√° existente ‚Äî n√£o abre editor"
exit 0

echo "-------------------------------------------"

